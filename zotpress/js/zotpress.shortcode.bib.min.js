jQuery(document).ready((function(){if(jQuery(".zp-Zotpress-Bib").length>0){var t={},e=0;jQuery(".zp-Zotpress-Bib").each((function(e,r){var n=jQuery(r),i={zpItemkey:!1};if(jQuery(".ZP_ITEM_KEY",n).text().trim().length>0&&(i.zpItemkey=jQuery(".ZP_ITEM_KEY",n).text()),i.zpItemType=!1,jQuery(".ZP_ITEMTYPE",n).text().trim().length>0&&(i.zpItemType=jQuery(".ZP_ITEMTYPE",n).text()),i.zpCollectionId=!1,jQuery(".ZP_COLLECTION_ID",n).text().trim().length>0&&(i.zpCollectionId=jQuery(".ZP_COLLECTION_ID",n).text()),i.zpTagId=!1,jQuery(".ZP_TAG_ID",n).text().trim().length>0&&(i.zpTagId=jQuery(".ZP_TAG_ID",n).text()),i.zpAuthor=!1,jQuery(".ZP_AUTHOR",n).text().trim().length>0&&(i.zpAuthor=jQuery(".ZP_AUTHOR",n).text()),i.zpYear=!1,jQuery(".ZP_YEAR",n).text().trim().length>0&&(i.zpYear=jQuery(".ZP_YEAR",n).text()),i.zpStyle=!1,jQuery(".ZP_STYLE",n).text().trim().length>0&&(i.zpStyle=jQuery(".ZP_STYLE",n).text()),i.zpLimit=!1,jQuery(".ZP_LIMIT",n).text().trim().length>0&&(i.zpLimit=jQuery(".ZP_LIMIT",n).text()),i.zpTitle=!1,jQuery(".ZP_TITLE",n).text().trim().length>0&&(i.zpTitle=jQuery(".ZP_TITLE",n).text()),i.zpShowImages=!1,jQuery(".ZP_SHOWIMAGE",n).text().trim().length>0&&(i.zpShowImages=jQuery(".ZP_SHOWIMAGE",n).text().trim()),i.zpShowTags=!1,jQuery(".ZP_SHOWTAGS",n).text().trim().length>0&&(i.zpShowTags=!0),i.zpDownloadable=!1,jQuery(".ZP_DOWNLOADABLE",n).text().trim().length>0&&(i.zpDownloadable=!0),i.zpInclusive=!1,jQuery(".ZP_INCLUSIVE",n).text().trim().length>0&&(i.zpInclusive=!0),i.zpShowNotes=!1,jQuery(".ZP_NOTES",n).text().trim().length>0&&(i.zpShowNotes=!0),i.zpShowAbstracts=!1,jQuery(".ZP_ABSTRACT",n).text().trim().length>0&&(i.zpShowAbstracts=!0),i.zpCiteable=!1,jQuery(".ZP_CITEABLE",n).text().trim().length>0&&(i.zpCiteable=!0),i.zpTarget=!1,jQuery(".ZP_TARGET",n).text().trim().length>0&&(i.zpTarget=!0),i.zpURLWrap=!1,jQuery(".ZP_URLWRAP",n).text().trim().length>0&&(i.zpURLWrap=jQuery(".ZP_URLWRAP",n).text()),i.zpHighlight=!1,jQuery(".ZP_HIGHLIGHT",n).text().trim().length>0&&(i.zpHighlight=jQuery(".ZP_HIGHLIGHT",n).text()),i.zpForceNumsCount=1,i.zpBibIndex=e,i.zpCollectionId&&-1!=i.zpCollectionId.indexOf(","))t[e]=i.zpCollectionId.split(","),i.zpCollectionId=t[e][0],a(0,0,n,i,!1);else if(i.zpTagId&&1==i.zpInclusive&&-1!=i.zpTagId.indexOf(",")){var s=i.zpTagId.split(",");jQuery.each(s,(function(t,e){i.zpTagId=e,a(0,0,n,i,!1)}))}else if(i.zpAuthor&&-1!=i.zpAuthor.indexOf(",")){var p=i.zpAuthor.split(",");1==i.zpInclusive?jQuery.each(p,(function(t,e){i.zpAuthor=e,a(0,0,n,i,!1)})):a(0,0,n,i,!1)}else if(i.zpYear&&-1!=i.zpYear.indexOf(",")){var o=i.zpYear.split(",");jQuery.each(o,(function(t,e){i.zpYear=e,a(0,0,n,i,!1)}))}else a(0,0,n,i,!1)}))}function a(n,i,s,p,o){void 0!==n&&"false"!=n&&""!=n||(n=0),void 0!==i&&"false"!=i&&""!=i||(i=0),jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",instance_id:s.attr("id"),api_user_id:jQuery(".ZP_API_USER_ID",s).text(),item_type:jQuery(".ZP_ITEM_TYPE",s).text(),item_key:p.zpItemkey,itemtype:p.zpItemType,collection_id:p.zpCollectionId,tag_id:p.zpTagId,author:encodeURI(p.zpAuthor).replace("'","%27"),year:p.zpYear,style:p.zpStyle,limit:p.zpLimit,title:p.zpTitle,showimage:p.zpShowImages,showtags:p.zpShowTags,downloadable:p.zpDownloadable,inclusive:p.zpInclusive,shownotes:p.zpShowNotes,showabstracts:p.zpShowAbstracts,citeable:p.zpCiteable,target:p.zpTarget,urlwrap:p.zpURLWrap,highlight:p.zpHighlight,sortby:jQuery(".ZP_SORTBY",s).text(),order:jQuery(".ZP_ORDER",s).text(),update:o,request_start:n,request_last:i,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(n){var i=jQuery.parseJSON(n);if(o||(e+=i.data.length),o&&console.log("zp: checking for updates ..."),o?console.log("zp: updating items",i.data.length):console.log("zp: adding items",i.data.length),console.log("zp: total items so far",e),"empty"==i.status||"Not found"==i.data){var l=zpShortcodeAJAX.txt_zperror+" ";0==i.data?(i.data=zpShortcodeAJAX.txt_noitemsfound,l=i.data):l+=i.data,console.log("Zotpress: "+l);var u="";jQuery("#"+i.instance+" .zp-List .zp-Entry").length>0&&(u=' class="hide"'),jQuery("#"+i.instance+" .zp-List").removeClass("loading").append("<p"+u+">"+l+"</p>")}else if(jQuery("#"+i.instance+" .zp-SEO-Content").remove(),void 0!==i&&null!=i&&0!=i&&i.data.length>0){var c="";if(1==p.zpShowNotes)var d="";!1===o?jQuery("#"+i.instance+" .zp-List").addClass("used_cache"):!0===o&&(!jQuery("#"+i.instance+" .zp-List").hasClass("updating")&&jQuery("#"+i.instance+" .zp-Citation-Notes").length>0&&jQuery("#"+i.instance+" .zp-Citation-Notes").remove(),jQuery("#"+i.instance+" .zp-List").hasClass("updating")||jQuery("#"+i.instance+" .zp-List").addClass("updating"),p.zpForceNumsCount=1),0!=i.data&&jQuery.each(i.data,(function(t,e){var a="",r=jQuery("#"+i.instance+" .zp-List #zp-ID-"+jQuery(".ZP_POSTID",s).text()+"-"+jQuery(".ZP_API_USER_ID",s).text()+"-"+e.key);if(r.length>0&&!1===o&&!jQuery("#"+i.instance+" .zp-List").hasClass("used_cache"))return!1;var n="none";e.data.hasOwnProperty("itemType")&&(n=e.data.itemType);var l="0000",u="0000";e.meta.hasOwnProperty("parsedDate")&&(l=e.meta.parsedDate.substring(0,4),u=e.meta.parsedDate);var z=e.data.title;e.meta.hasOwnProperty("creatorSummary")&&(z=e.meta.creatorSummary.replace(/ /g,"-")),a+="<a href='https://docs.opendeved.net/lib/"+e.key+"'>",a+=" data-zp-author-date='"+z+"-"+u+"'",a+=" data-zp-date-author='"+u+"-"+z+"'",a+=" data-zp-date='"+u+"'",a+=" data-zp-year='"+l+"'",a+=" data-zp-itemtype='"+n+"'",a+=" class='zp-Entry zpSearchResultsItem",!0===o&&(a+=" zp_updated"),jQuery("#"+i.instance+" .ZP_SHOWIMAGE").text().trim().length>0&&e.hasOwnProperty("image")?(a+=" zp-HasImage'>\n",a+="<div id='zp-Citation-"+e.key+"' class='zp-Entry-Image hasImage' rel='"+e.key+"'>\n","image"==p.zpURLWrap&&""!=e.data.url&&(a+="<a href='"+e.data.url+"'",p.zpTarget&&(a+=" target='_blank'"),a+=">"),a+="<img class='thumb' src='"+e.image[0]+"' alt='image' />\n","image"==p.zpURLWrap&&""!=e.data.url&&(a+="</a>"),a+="</div>\n"):a+="'>\n",jQuery("#"+i.instance+" .ZP_FORCENUM").text().length>0&&"1"==jQuery("#"+i.instance+" .ZP_FORCENUM").text()&&(/csl-left-margin/i.test(e.bib)||(e.bib=e.bib.replace('<div class="csl-entry">','<div class="csl-entry">'+p.zpForceNumsCount+". "),p.zpForceNumsCount++)),a+=e.bib,1==p.zpShowAbstracts&&e.data.hasOwnProperty("abstractNote")&&e.data.abstractNote.length>0&&(a+="<p class='zp-Abstract'><span class='zp-Abstract-Title'>Abstract:</span> "+e.data.abstractNote+"</p>\n"),1==p.zpShowTags&&e.data.hasOwnProperty("tags")&&e.data.tags.length>0&&(a+="<p class='zp-Zotpress-ShowTags'><span class='title'>Tags:</span> ",jQuery.each(e.data.tags,(function(t,r){a+="<span class='tag'>"+r.tag+"</span>",t!=e.data.tags.length-1&&(a+="<span class='separator'>,</span> ")})),a+="</p>\n"),a+="</div>\n",a+="</a>\n",1==p.zpShowNotes&&e.hasOwnProperty("notes")&&(d+=e.notes),r.length>0&&!0===o?r.replaceWith(jQuery(a)):c+=a})),!1===o&&jQuery("#"+i.instance+" .zp-List").append(c),1==p.zpShowNotes&&d.length>0&&(d="<div class='zp-Citation-Notes'>\n<h4>Notes</h4>\n<ol>\n"+d,d+="</ol>\n</div>\x3c!-- .zp-Citation-Notes --\x3e\n\n",jQuery("#"+i.instance).append(d)),jQuery("#"+i.instance+" .zp-List .csl-left-margin").length>0&&jQuery(".ZP_STYLE",s).text().trim().length>0&&"american-antiquity"!=jQuery(".ZP_STYLE",s).text().trim()&&(p.zpForceNumsCount=1,jQuery("#"+i.instance+" .zp-List .csl-left-margin").each((function(t,e){var a=jQuery(e).text();a=a.replace(a.match(/\d+/)[0],p.zpForceNumsCount),jQuery(e).text(a),p.zpForceNumsCount++}))),r(s,i,p),0!=i.meta.request_next&&"false"!=i.meta.request_next?a(i.meta.request_next,i.meta.request_last,s,p,o):(jQuery("#"+i.instance+" .zp-List").removeClass("loading"),jQuery("#"+i.instance+" .zp-List").hasClass("updating")?t[p.zpBibIndex]&&t[p.zpBibIndex].length>0&&t[p.zpBibIndex][t[p.zpBibIndex].length-1]!=p.zpCollectionId?(p.zpCollectionId=t[p.zpBibIndex][t[p.zpBibIndex].indexOf(p.zpCollectionId)+1],jQuery("#"+i.instance+" .zp-List").removeClass("updating"),a(0,0,s,p,!1)):(console.log("zp: done + reformat if needed"),r(s,i,p)):a(0,0,s,p,!0))}else console.log("zp: done"),!0===o&&(jQuery("#"+s.attr("id")+" .zp-List").removeClass("loading"),0==jQuery("#"+s.attr("id")+" .zp-List .zp-Entry").length&&jQuery("#"+s.attr("id")+" .zp-List").append("<p>There are no citations to display.</p>\n"))},error:function(t){console.log("Zotpress via WP AJAX Error: ",t)}})}function r(t,e,a){var r=jQuery(".ZP_SORTBY",t).text(),n=jQuery(".ZP_ORDER",t).text(),i="data-zp-author-date";if("date"==r&&(i="data-zp-date-author"),function(t,e,a,r){-1!==["author","date"].indexOf(e)&&0==jQuery("#"+t.instance+" .zp-List .csl-left-margin").length&&jQuery("#"+t.instance+" .zp-List div.zp-Entry").sort((function(t,e){var n=t.getAttribute(a).toLowerCase(),i=e.getAttribute(a).toLowerCase();return n>i?"asc"==r?1:-1:n<i?"asc"==r?-1:1:0})).detach().appendTo("#"+t.instance+" .zp-List")}(e,r,i,n),!1!==a.zpTitle){var s={};jQuery("#"+e.instance+" .zp-List div.zp-Entry").each((function(t,e){var r=jQuery(e).data("zp-"+a.zpTitle);!1===s.hasOwnProperty(r)&&(s[r]=[]),s[r].push(jQuery(e).attr("id"))}));var p=Object.getOwnPropertyNames(s);if("itemtype"==a.zpTitle){var o=["book","bookSection","journalArticle","conferencePaper","thesis","report","encyclopediaArticle","newspaperArticle","magazineArticle","presentation","interview","dictionaryEntry","document","manuscript","patent","map","blogPost","webpage","artwork","film","audioRecording","statute","bill","case","hearing","forumPost","letter","email","instantMessage","software","podcast","radioBroadcast","tvBroadcast","videoRecording","attachment","note"];o.slice(0).forEach((function(t,e){-1==p.indexOf(t)&&o.splice(o.indexOf(t),1)})),p=o}else"asc"==n?p.sort((function(t,e){return t-e})):p.sort((function(t,e){return e-t}));p.forEach((function(e,i){var p=e;if("itemtype"==a.zpTitle){if(null!==p.match(/[A-Z]/)){var o=p.match(/[A-Z]/).index;p=p.substr(0,o)+" "+p.substr(o)}p=p.charAt(0).toUpperCase()+p.slice(1)}"0000"==p&&(p="No date"),a.zpTitle,0==jQuery("#"+t.attr("id")+" .zp-List h3[rel='"+e+"']").length&&jQuery("#"+t.attr("id")+" .zp-List").append("<h3 rel='"+e+"'>"+p+"</h3>\n"),("year"==a.zpTitle&&"asc"==n||"itemtype"==a.zpTitle&&"date"==r)&&s[e].reverse(),s[e].forEach((function(a,r){jQuery("#"+t.attr("id")+" #"+a).insertAfter(jQuery("#"+t.attr("id")+" .zp-List h3[rel='"+e+"']"))}))}))}}}));
